<!doctype html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>SDGs不塑永續-淨灘</title>
  <style>
    html,body{height:100%;margin:0;font-family:system-ui,-apple-system,'Segoe UI',Roboto,'Noto Sans CJK TC',sans-serif;cursor:url('images/cursor.png'),auto;overflow:hidden}
    .stage{position:relative;width:100%;height:100vh;background-image:url('images/beach.jpg');background-size:cover;background-position:center;overflow:hidden}
    header{position:absolute;left:16px;top:12px;font-weight:800;font-size:28px;color:#0b3a2e;text-shadow:0 2px 4px rgba(255,255,255,0.6)}
    .hud{position:absolute;right:16px;top:12px;text-align:right;color:#063;}
    .hud .score{font-weight:700;font-size:18px}
    .hud .remaining{font-size:14px}

    .trash{position:absolute;user-select:none;touch-action:none;transition:transform 140ms ease-out, opacity 300ms ease;}
    .trash:hover{cursor:url('images/hand.png'),pointer;transform:scale(1.1) rotate(var(--rot));}
    .trash.collected{transform:scale(0.4) rotate(720deg);opacity:0;pointer-events:none}

    .overlay,.start-screen{position:absolute;inset:0;display:flex;align-items:center;justify-content:center;background:rgba(0,0,0,0.45);backdrop-filter:blur(2px);transition:opacity 220ms}
    .overlay{opacity:0;pointer-events:none}
    .overlay.show{opacity:1;pointer-events:auto}
    .start-screen{opacity:1;z-index:999;flex-direction:column;color:#fff;text-shadow:0 2px 6px rgba(0,0,0,0.5)}
    .start-screen.hidden{opacity:0;pointer-events:none;}

    .panel{background:#fff;border-radius:10px;padding:28px 32px;text-align:center;box-shadow:0 10px 30px rgba(0,0,0,0.25)}
    .panel h1{margin:0 0 8px;font-size:28px;color:#0b3a2e}
    .panel p{margin:6px 0 18px}
    .btn{display:inline-block;padding:10px 16px;border-radius:8px;background:#0b3a2e;color:#fff;text-decoration:none;font-weight:700;cursor:pointer}
    .btn:hover{background:#115f49}
  </style>
</head>
<body>
  <audio id="bgm" src="audio/beach_bgm.mp3" loop autoplay></audio>
  <audio id="pickupSound" src="audio/pick.mp3"></audio>

  <div class="stage" id="stage">
    <header>SDGs不塑永續-淨灘</header>
    <div class="hud">
      <div class="score">分數：<span id="score">0</span></div>
      <div class="remaining">剩餘：<span id="remaining">50</span></div>
    </div>

    <div class="overlay" id="overlay">
      <div class="panel">
        <h1 id="overlay-title">任務成功！</h1>
        <p id="overlay-msg">你已經把海灘清理完成！</p>
        <a href="#" class="btn" id="next-btn">重新開始</a>
      </div>
    </div>

    <div class="start-screen" id="start-screen">
      <h1 style="font-size:48px;font-weight:900;margin-bottom:24px;">SDGs不塑永續-淨灘</h1>
      <button id="start-btn" class="btn" style="font-size:20px;padding:14px 24px;">開始遊戲</button>
    </div>
  </div>

  <script>
    const trashTypes = [
      	{name:'保特瓶1', file:'images/bottle1.png', score:1, w:12, h:48},
	{name:'保特瓶2', file:'images/bottle2.png', score:1, w:48, h:64},
	{name:'保特瓶3', file:'images/bottle3.png', score:1, w:64, h:48},
	{name:'鞋子1', file:'images/shoe1.png', score:6, w:48, h:48},
	{name:'鞋子2', file:'images/shoe2.png', score:6, w:128, h:128},
	{name:'鞋子3', file:'images/shoe3.png', score:6, w:48, h:48},
	{name:'紙類餐盒', file:'images/box.png', score:4, w:64, h:64},
	{name:'塑膠袋', file:'images/bag.png', score:2, w:128, h:128},
      	{name:'保麗龍', file:'images/net.png', score:10, w:256, h:256},
      	{name:'漂流垃圾1', file:'images/other1.png', score:8, w:64, h:64},
	{name:'漂流垃圾2', file:'images/other2.png', score:8, w:64, h:64}
    ];

    const total = 50;
    let score = 0;
    let remaining = total;

    const stage = document.getElementById('stage');
    const scoreEl = document.getElementById('score');
    const remainingEl = document.getElementById('remaining');
    const overlay = document.getElementById('overlay');
    const overlayTitle = document.getElementById('overlay-title');
    const overlayMsg = document.getElementById('overlay-msg');
    const nextBtn = document.getElementById('next-btn');
    const bgm = document.getElementById('bgm');
    const pickupSound = document.getElementById('pickupSound');
    const startScreen = document.getElementById('start-screen');
    const startBtn = document.getElementById('start-btn');

    function rand(min,max){return Math.random()*(max-min)+min}

    function placeTrash(){
      const vw = Math.max(document.documentElement.clientWidth||0,window.innerWidth||0);
      const vh = Math.max(document.documentElement.clientHeight||0,window.innerHeight||0);
      for(let i=0;i<total;i++){
        const t = trashTypes[Math.floor(Math.random()*trashTypes.length)];
        const img = document.createElement('img');
        img.src=t.file;img.className='trash';img.alt=t.name;img.dataset.score=t.score;img.dataset.type=t.name;
        const scale=rand(0.8,1.3);const width=t.w*scale;const height=t.h*scale;
        img.style.width=width+'px';img.style.height=height+'px';
        const minTop=vh*0.55;const maxTop=vh*0.88-height;const top=rand(minTop,Math.max(minTop,maxTop));
        const left=rand(8,vw-width-8);
        const rot=Math.floor(rand(0,360));
        img.style.left=left+'px';img.style.top=top+'px';
        img.style.setProperty('--rot',rot+'deg');
        img.style.transform=`rotate(${rot}deg)`;
        img.style.zIndex=Math.floor(rand(1,50));
        img.addEventListener('click',onCollect);
        img.addEventListener('touchstart',onCollect);
        stage.appendChild(img);
      }
    }

    function onCollect(e){
      e.stopPropagation();
      const el=e.currentTarget;
      if(!el||el.classList.contains('collected'))return;
      pickupSound.currentTime=0;pickupSound.play().catch(()=>{});
      const s=parseInt(el.dataset.score||'0',10);
      score+=s;remaining-=1;
      scoreEl.textContent=score;remainingEl.textContent=remaining;
      el.classList.add('collected');
      setTimeout(()=>{if(el&&el.parentNode)el.parentNode.removeChild(el);},400);
      if(remaining<=0){setTimeout(()=>showOverlay(),500);}
    }

    function showOverlay(){
      overlay.classList.add('show');
      overlayTitle.textContent='任務成功！';
      overlayMsg.textContent=`清理完成，總得分：${score} 分`;
      bgm.pause();
    }

    nextBtn.addEventListener('click',function(ev){ev.preventDefault();location.reload();});

    function startGame(){
      startScreen.classList.add('hidden');
      bgm.volume=0.5;
      bgm.play().catch(()=>{});
      placeTrash();
    }

    startBtn.addEventListener('click',startGame);
  </script>
</body>
</html>
